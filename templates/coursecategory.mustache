{{!
    @template theme_lucent/coursecategory

    Lucent course category page with card grid and category filters.
    Wraps the standard drawers layout but injects a custom course listing.
}}
{{> theme_boost/head }}

<body {{{ bodyattributes }}}>
{{> core/local/toast/wrapper}}
<div id="page-wrapper" class="d-print-block lucent-page-wrapper">

    {{{ output.standard_top_of_body_html }}}

    {{! â”€â”€ Lucent Navbar â”€â”€ }}
    {{> theme_lucent/navbar }}

    {{! â”€â”€ Course Index Drawer (Left) â”€â”€ }}
    {{#courseindex}}
        {{< theme_boost/drawer }}
            {{$id}}theme_boost-drawers-courseindex{{/id}}
            {{$drawerheadercontent}}
                {{> theme_boost/courseindexdrawercontrols}}
            {{/drawerheadercontent}}
            {{$drawerclasses}}drawer drawer-left lucent-drawer lucent-drawer-course {{#courseindexopen}}show{{/courseindexopen}}{{/drawerclasses}}
            {{$drawercontent}}
                {{{courseindex}}}
            {{/drawercontent}}
            {{$drawerpreferencename}}drawer-open-index{{/drawerpreferencename}}
            {{$drawerstate}}show-drawer-left{{/drawerstate}}
            {{$tooltipplacement}}right{{/tooltipplacement}}
            {{$closebuttontext}}{{#str}}closecourseindex, core{{/str}}{{/closebuttontext}}
        {{/ theme_boost/drawer}}
    {{/courseindex}}

    {{! â”€â”€ Blocks Drawer (Right) â”€â”€ }}
    {{#hasblocks}}
        {{< theme_boost/drawer }}
            {{$id}}theme_boost-drawers-blocks{{/id}}
            {{$drawerclasses}}drawer drawer-right lucent-drawer lucent-drawer-blocks{{#blockdraweropen}} show{{/blockdraweropen}}{{/drawerclasses}}
            {{$drawercontent}}
                <div class="d-print-none">
                    {{{ addblockbutton }}}
                    {{{ sidepreblocks }}}
                </div>
            {{/drawercontent}}
            {{$drawerpreferencename}}drawer-open-block{{/drawerpreferencename}}
            {{$forceopen}}{{#forceblockdraweropen}}1{{/forceblockdraweropen}}{{/forceopen}}
            {{$drawerstate}}show-drawer-right{{/drawerstate}}
            {{$tooltipplacement}}left{{/tooltipplacement}}
            {{$drawercloseonresize}}1{{/drawercloseonresize}}
            {{$closebuttontext}}{{#str}}closeblockdrawer, core{{/str}}{{/closebuttontext}}
        {{/ theme_boost/drawer}}
    {{/hasblocks}}

    {{! â”€â”€ Main page content â”€â”€ }}
    <div id="page" data-region="mainpage" data-usertour="scroller" class="drawers lucent-main-page {{#courseindexopen}}show-drawer-left{{/courseindexopen}} {{#blockdraweropen}}show-drawer-right{{/blockdraweropen}} drag-container">
        <div id="topofscroll" class="main-inner">

            {{! â”€â”€ Drawer toggle buttons â”€â”€ }}
            <div class="drawer-toggles d-flex">
                {{#courseindex}}
                    <div class="drawer-toggler drawer-left-toggle open-nav d-print-none">
                        <button
                            class="btn icon-no-margin lucent-drawer-toggle"
                            data-toggler="drawers"
                            data-action="toggle"
                            data-target="theme_boost-drawers-courseindex"
                            data-toggle="tooltip"
                            data-placement="right"
                            title="{{#str}}opendrawerindex, core{{/str}}"
                        >
                            <span class="sr-only">{{#str}}opendrawerindex, core{{/str}}</span>
                            {{#pix}} t/index_drawer, moodle {{/pix}}
                        </button>
                    </div>
                {{/courseindex}}
                {{#hasblocks}}
                    <div class="drawer-toggler drawer-right-toggle ms-auto d-print-none">
                        <button
                            class="btn icon-no-margin lucent-drawer-toggle"
                            data-toggler="drawers"
                            data-action="toggle"
                            data-target="theme_boost-drawers-blocks"
                            data-toggle="tooltip"
                            data-placement="right"
                            title="{{#str}}opendrawerblocks, core{{/str}}"
                        >
                            <span class="sr-only">{{#str}}opendrawerblocks, core{{/str}}</span>
                            <span class="dir-rtl-hide">{{#pix}}t/blocks_drawer, core{{/pix}}</span>
                            <span class="dir-ltr-hide">{{#pix}}t/blocks_drawer_rtl, core{{/pix}}</span>
                        </button>
                    </div>
                {{/hasblocks}}
            </div>

            {{! â”€â”€ Custom Course Listing (replaces default category tree) â”€â”€ }}
            <div class="lucent-course-listing-page">
                <div class="lucent-course-listing-header">
                    <h1 class="lucent-course-listing-title">{{{ lucentpagetitle }}}</h1>
                    <p class="lucent-course-listing-subtitle">Discover courses and start learning today</p>
                </div>

                {{! â”€â”€ Category filter pills â”€â”€ }}
                <div class="lucent-category-pills" id="lucent-category-pills">
                    <a href="{{{ config.wwwroot }}}/course/index.php"
                       class="lucent-pill {{^lucentselectedcategory}}active{{/lucentselectedcategory}}">All</a>
                    {{#lucentallcategories}}
                    <a href="{{{ config.wwwroot }}}/course/index.php?categoryid={{id}}"
                       class="lucent-pill" data-catid="{{id}}">{{name}}</a>
                    {{/lucentallcategories}}
                </div>

                {{! â”€â”€ Search bar â”€â”€ }}
                <div class="lucent-course-search-bar">
                    <input type="text" id="lucent-course-search" class="lucent-course-search-input"
                           placeholder="Search courses..." autocomplete="off">
                    <svg class="lucent-course-search-icon" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
                    </svg>
                </div>

                {{! â”€â”€ Course grid â”€â”€ }}
                <div class="lucent-courses-grid" id="lucent-course-grid">
                    {{#lucentcourses}}
                    <a href="{{{ url }}}" class="lucent-course-card" data-coursename="{{{fullname}}}" data-catname="{{{catname}}}">
                        <div class="lucent-course-image" {{#image}}style="background-image: url('{{{ image }}}')"{{/image}}>
                            {{^image}}
                            <div class="lucent-course-placeholder">ðŸ“š</div>
                            {{/image}}
                            {{#catname}}
                            <span class="lucent-course-badge">{{{catname}}}</span>
                            {{/catname}}
                        </div>
                        <div class="lucent-course-body">
                            <h3 class="lucent-course-title">{{{fullname}}}</h3>
                            {{#summary}}
                            <p class="lucent-course-desc">{{summary}}</p>
                            {{/summary}}
                        </div>
                        <div class="lucent-course-footer">
                            <span class="lucent-course-meta">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
                                {{numsections}} sections
                            </span>
                            <span class="lucent-course-arrow">â†’</span>
                        </div>
                    </a>
                    {{/lucentcourses}}
                    {{^lucentcourses}}
                    <div class="lucent-no-courses">
                        <div class="lucent-no-courses-icon">ðŸ“­</div>
                        <h3>No courses found</h3>
                        <p>There are no courses available in this category yet.</p>
                    </div>
                    {{/lucentcourses}}
                </div>
            </div>

            {{! â”€â”€ Original Moodle content (hidden but present for Moodle's requirements) â”€â”€ }}
            <div id="page-content" class="pb-3 d-print-block lucent-page-content" style="display:none !important;">
                <div id="region-main-box">
                    {{#hasregionmainsettingsmenu}}
                    <div id="region-main-settings-menu" class="d-print-none">
                        <div> {{{ regionmainsettingsmenu }}} </div>
                    </div>
                    {{/hasregionmainsettingsmenu}}
                    <div id="region-main" class="lucent-region-main">
                        {{{ output.course_content_header }}}
                        {{#headercontent}}
                            {{> core/activity_header }}
                        {{/headercontent}}
                        {{#overflow}}
                            <div class="container-fluid tertiary-navigation">
                                <div class="navitem">
                                    {{> core/url_select}}
                                </div>
                            </div>
                        {{/overflow}}
                        {{{ output.main_content }}}
                        {{{ output.activity_navigation }}}
                        {{{ output.course_content_footer }}}
                    </div>
                </div>
            </div>
        </div>
        {{> theme_lucent/footer }}
    </div>
    {{{ output.standard_after_main_region_html }}}
</div>

{{! â”€â”€ Mobile Bottom Navigation Bar â”€â”€ }}
<nav class="lucent-bottom-nav d-md-none" aria-label="Mobile navigation">
    <a href="{{{ config.wwwroot }}}/my/" class="lucent-bottom-nav-item" data-nav="home">
        <i class="fa fa-home"></i>
        <span>Home</span>
    </a>
    <a href="{{{ config.wwwroot }}}/my/courses.php" class="lucent-bottom-nav-item" data-nav="courses">
        <i class="fa fa-graduation-cap"></i>
        <span>Courses</span>
    </a>
    <button class="lucent-bottom-nav-item lucent-bottom-nav-search" data-action="toggle-search" data-nav="search">
        <i class="fa fa-search"></i>
        <span>Search</span>
    </button>
    <a href="{{{ config.wwwroot }}}/message/index.php" class="lucent-bottom-nav-item" data-nav="messages">
        <i class="fa fa-bell"></i>
        <span>Alerts</span>
    </a>
    <a href="{{{ config.wwwroot }}}/user/profile.php" class="lucent-bottom-nav-item" data-nav="profile">
        <i class="fa fa-user"></i>
        <span>Profile</span>
    </a>
</nav>

</body>
</html>
{{#js}}
M.util.js_pending('theme_boost/loader');
require(['theme_boost/loader', 'theme_boost/drawer'], function(Loader, Drawer) {
    Drawer.init();
    M.util.js_complete('theme_boost/loader');
});
{{/js}}

{{! â”€â”€ Explore Mega-Menu Injection â”€â”€ }}
<script>
(function() {
    var cats = {{{ lucentcategories }}};
    if (!cats || !cats.length) return;

    function buildExploreMenu(navLink) {
        if (!navLink) return;
        var li = navLink.closest('li') || navLink.parentElement;
        li.style.position = 'relative';
        li.classList.add('lucent-explore-wrapper');

        navLink.textContent = 'Explore';
        navLink.classList.add('lucent-explore-trigger');

        var caret = document.createElement('span');
        caret.innerHTML = ' &#9662;';
        caret.style.fontSize = '0.625rem';
        caret.style.marginLeft = '4px';
        navLink.appendChild(caret);

        var dropdown = document.createElement('div');
        dropdown.className = 'lucent-explore-dropdown';

        cats.forEach(function(cat) {
            var item = document.createElement('div');
            item.className = 'lucent-explore-item';

            var link = document.createElement('a');
            link.href = M.cfg.wwwroot + '/course/index.php?categoryid=' + cat.id;
            link.textContent = cat.name;
            link.className = 'lucent-explore-cat-link';
            item.appendChild(link);

            if (cat.children && cat.children.length) {
                var arrow = document.createElement('span');
                arrow.className = 'lucent-explore-arrow';
                arrow.innerHTML = '&#9656;';
                link.appendChild(arrow);

                var submenu = document.createElement('div');
                submenu.className = 'lucent-explore-submenu';
                cat.children.forEach(function(sub) {
                    var sublink = document.createElement('a');
                    sublink.href = M.cfg.wwwroot + '/course/index.php?categoryid=' + sub.id;
                    sublink.textContent = sub.name;
                    sublink.className = 'lucent-explore-sub-link';
                    submenu.appendChild(sublink);
                });
                item.appendChild(submenu);
            }
            dropdown.appendChild(item);
        });

        var viewAll = document.createElement('a');
        viewAll.href = M.cfg.wwwroot + '/course/index.php';
        viewAll.className = 'lucent-explore-viewall';
        viewAll.textContent = 'View All Courses â†’';
        dropdown.appendChild(viewAll);

        li.appendChild(dropdown);
    }

    document.addEventListener('DOMContentLoaded', function() {
        var navLinks = document.querySelectorAll('.primary-navigation a, .moremenu a');
        navLinks.forEach(function(link) {
            var text = link.textContent.trim();
            var href = link.getAttribute('href') || '';
            if ((text === 'Courses' || text === 'courses') ||
                href.indexOf('/course/index.php') !== -1) {
                buildExploreMenu(link);
            }
        });
    });
})();
</script>

<script>
(function() {
    // Mark active category pill
    var catId = new URLSearchParams(window.location.search).get('categoryid');
    if (catId) {
        var pills = document.querySelectorAll('.lucent-pill');
        pills.forEach(function(pill) {
            pill.classList.remove('active');
            if (pill.getAttribute('data-catid') === catId) {
                pill.classList.add('active');
            }
        });
    }

    // Client-side course search
    var searchInput = document.getElementById('lucent-course-search');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            var q = this.value.toLowerCase().trim();
            var cards = document.querySelectorAll('#lucent-course-grid .lucent-course-card');
            cards.forEach(function(card) {
                var name = (card.getAttribute('data-coursename') || '').toLowerCase();
                var cat = (card.getAttribute('data-catname') || '').toLowerCase();
                card.style.display = (!q || name.indexOf(q) !== -1 || cat.indexOf(q) !== -1) ? '' : 'none';
            });
        });
    }
})();
</script>
